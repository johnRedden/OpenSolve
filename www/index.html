<!DOCTYPE html>
<html>
<!--
  * Open Source Symbolic Project
  Rachel made a change!
  -->
<head>
    <title>Open CAS</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">

    <!-- see http://webdesign.tutsplus.com/tutorials/htmlcss-tutorials/quick-tip-dont-forget-the-viewport-meta-tag -->
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=no">
    <style>
        /* following two viewport lines are equivalent to meta viewport statement above, needed for Windows */
        /* see http://www.quirksmode.org/blog/archives/2014/05/html5_dev_conf.html and http://dev.w3.org/csswg/css-device-adapt/ */
        @-ms-viewport { width: 100vw ; min-zoom: 100% ; zoom: 100% ; }  @viewport { width: 100vw ; min-zoom: 100% zoom: 100% ; }
        @-ms-viewport { user-zoom: fixed ; min-zoom: 100% ; }           @viewport { user-zoom: fixed ; min-zoom: 100% ; }
    </style>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="js/algebrite.js"></script>
    
    <!-- Latest compiled and minified bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    
    
    

    <!-- Uncomment the following scripts if you convert your "Standard HTML5" project into a "Cordova" project. -->
    <!-- <script src="cordova.js"></script> -->          <!-- phantom library, needed for Cordova api calls, added during build -->
    <!-- <script src="js/app.js"></script> -->           <!-- recommended location of your JavaScript code relative to other JS files -->
    <!-- <script src="xdk/init-dev.js"></script> -->     <!-- normalizes device and document ready events, see README for details -->
</head>

<body>

    <div class="container">
        <h2>Open Solve</h2>
        <hr>
        <div class="row">
          <div class="col-lg-12">
            <div class="input-group">
              <input id="userInput" type="text" class="form-control" aria-label="..." autofocus>
              <div class="input-group-btn">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Action <span class="caret"></span></button>
                <ul class="dropdown-menu dropdown-menu-right">
                  <li><a href="#evaluate" command="eval">Evaluate</a></li>
                  <li><a href="#simplify" command="simplify">Simplify</a></li>
                  <li><a href="#solve" command="roots">Solve</a></li>
                  <li><a href="#derivative" command="d">Derivative</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="#">More Commands Soon!</a></li>
                </ul>
              </div><!-- /btn-group -->
            </div><!-- /input-group -->
          </div><!-- /.col-lg-6 -->
        </div><!-- /.row -->
        <hr>
        <p> </p>
        <pre id="mainResult" class="text-center">Enter Ascii Math</pre>
        <p> </p>
        <pre id="steps" class="text-center">Steps Maybe</pre>
        <p> </p>
        <a href="http://algebrite.org/reference.html" target="_blank">Function Ref.</a>
        
    </div>
   
    
    <script>
        
        $('document').ready(function(){
            //Your awesome javascript goes here.
            
            $('#userInput').on('keyup',function(e){
                var inputTxt = $(this).val().trim();
                var output = mathWorks(inputTxt, '');
                mathSimpleDisplay(output);
            });
            
            $('.dropdown-menu a').click(function(){
                var cmd = $(this).attr('command');
                var inputTxt = $('#userInput').val().trim();
                var output = mathWorks(inputTxt, cmd);
                mathSimpleDisplay(output);
                
                //steps for solving detected here
                if(cmd=='roots') $('#steps').html(mathSolve(inputTxt)) ;
            });
            
        });
        
        // utility functions
        function mathWorks(asciiMath, command){
            var resultTxt = "";
            var commandStr = command+'('+asciiMath+')';
            if(asciiMath==="") 
                    resultTxt="Enter Ascii Math";
            else
                    resultTxt = '= '+Algebrite.run(commandStr);
            
            return {
                command:commandStr,
                result: resultTxt
            }
        }
        function mathSimpleDisplay(arg){
            $('#mainResult').html(arg.command+'<br/>'+arg.result);
        }
        
        function mathSolve(arg){
            
            var lhs = arg.substr(0,arg.indexOf('='));
            var rhs = arg.substr(arg.indexOf('=')+1, arg.length);
            if(lhs===''){
                lhs=rhs;
                rhs='0';
            }
            
            var lhsDeg = Algebrite.run('deg('+lhs+')');
            var rhsDeg = Algebrite.run('deg('+rhs+')');
            
            
            var outHTML ='No steps detected.';
            
            
            if((lhsDeg==='1'||lhsDeg==='0') && (rhsDeg==='0'||rhsDeg==='1')){
                outHTML = mathSolveGeneralLinear(lhs,rhs);
            }
            
            return outHTML;
            
        }
        // send linear left hand side and right hand side... catches all scenarios
        function mathSolveGeneralLinear(lhs, rhs){
            var outHTML = 'Solving Linear Equations <br/>';
            outHTML += lhs +' = '+rhs+'<br/><br/>';
            
            //Quote the original ascii input (quote is not what I expected?)
            var origlhs = Algebrite.run('quote('+lhs+')');
            var origrhs = Algebrite.run('quote('+rhs+')');
            outHTML += origlhs +' = '+origrhs+'<br/>';
            
            //outHTML += 'Add same-side like terms.<br/>';
            var newlhs = Algebrite.run(lhs);
            var newrhs = Algebrite.run(rhs);
            if(origlhs!=newlhs || origrhs!=newrhs){
                outHTML += newlhs +' = '+newrhs+'<br/>';
                origlhs=newlhs;
                origrhs=newrhs;
            }
                
            var likeTerm = Algebrite.run('-1*(coeff('+origrhs+',x,1))'); //coeff of deg 1 term
            //outHTML += 'Combine opposite-side like terms. Add '+likeTerm+'x to both sides<br/>';
            newlhs = Algebrite.run(origlhs+'+('+likeTerm+'x)');
            newrhs = Algebrite.run(origrhs+'+('+likeTerm+'x)');
            if(origlhs!=newlhs || origrhs!=newrhs){
                outHTML += newlhs +' = '+newrhs+'<br/>';
                origlhs=newlhs;
                origrhs=newrhs;
            }
            
            var deglhs = Algebrite.run('deg('+newlhs+')');
            
            if(deglhs!='0'){
                var constTerm = Algebrite.run('-1*(coeff('+origlhs+',x,0))');
                //outHTML += 'Add '+constTerm+' to both sides<br/>';
                newlhs = Algebrite.run(origlhs+'+('+constTerm+')');
                newrhs = Algebrite.run(origrhs+'+('+constTerm+')');
                if(origlhs!=newlhs || origrhs!=newrhs){
                    outHTML += newlhs +' = '+newrhs+'<br/>';
                    origlhs=newlhs;
                    origrhs=newrhs;
                }
                
                var leadCoeff = Algebrite.run('coeff('+origlhs+',x,1)');
                //outHTML += 'Divide both sides by '+leadCoeff+'.<br/>';               
                
                newlhs = Algebrite.run(origlhs+'/('+leadCoeff+')');
                newrhs = Algebrite.run(origrhs+'/('+leadCoeff+')');
                if(origlhs!=newlhs || origrhs!=newrhs){
                    outHTML += newlhs +' = '+newrhs+'<br/>';
                    origlhs=newlhs;
                    origrhs=newrhs;
                }              
                
            }else{
                if(origlhs!=origrhs)
                    outHTML += 'No solution.<br/>';
                else
                    outHTML += 'All real numbers are solutions.<br/>';
            }

            return outHTML;
        }
        

    </script>

</body>
</html>
